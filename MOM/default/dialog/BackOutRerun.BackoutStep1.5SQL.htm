<HTML>
<HEAD>
  <LINK localized="TRUE" rel="STYLESHEET" type="text/css" href="/mcm/default/localized/en-us/styles/styles.css">
</HEAD>
<BODY>
<FORM name='mdm'>
<!-- The title of the dialog-->
<table border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr><td Class='CaptionBar' nowrap>Identify Sessions Using SQL</td></tr>
</table>
<br>

<TABLE width="100%" BORDER="0"  CELLPADDING="0" CELLSPACING="0">
<TR>
<TD valign="top">
  <TABLE BORDER="0"  CELLPADDING="0" CELLSPACING="0">
   <TR>
      <TD width="32">&nbsp;</TD> 
      <TD class="fieldRequired" xstyle="font-size:14pt">An empty table with the name <b>t_rerun_session_<MDMLABEL Name="ReRunId"></MDMLABEL></b> has just been created in the database. The <MDMLABEL Name="ReRunId"></MDMLABEL> in the table name is the current rerun id.</TD>
   </TR>   
   <TR>
      <TD width="32">&nbsp;</TD> 
      <TD class="fieldRequired"><br>You will now need to access the database directly and execute the SQL necessary to populate this table, t_rerun_session_<MDMLABEL Name="ReRunId"></MDMLABEL>, with the session ids you wish to backout or resubmit.<br><br>Once you have populated the table with the session ids, select 'Next Step: Analyze' below to proceed to the 'Identify & Analyze' page where you can review what is going to be backed out and resubmitted before any action is taken on these sessions.</TD>
   </TR>
 </TABLE>
</TABLE>
<br>
<!-- Dialog Buttons -->

<div align="center">
  <button name="OK" class="clsButtonXLarge" onClick="mdm_RefreshDialog(this); return false;" ID="Button1">Next Step: Analyze&nbsp;<IMG valign=middle border=0 src="/mcm/default/localized/en-us/images/icons/arrowSelect.gif"></button>&nbsp;&nbsp;&nbsp;

</div>
<br><br>
<HR>
<br><br>
<h2>Examples</h2>
		Essentially you are just inserting the session ids of the transactions you wish to backout but the ids have to be inserted in a particular way. In addition, the query for inserting failed transaction ids is different from the query for inserting successful transaction ids.<br><br>If you make a mistake, no problem. As long as you haven't deleted or resubmitted the transactions, even if you have proceed to the next page (the Identify & Analyze page) and discover you have made a mistake, you can update the <b>t_rerun_session_<MDMLABEL Name="ReRunId"></MDMLABEL></b> table by adding or deleting records with out starting over as long as you select 'Reanalyze' at the top of the next page to update the summary information before continuing on to actually delete or resubmit the transactions.
		<br>
		<br>
<h3>Usage Transaction Example</h3>	
For example, if the following query selecting usage for account 137 that was processed before February 2005 represented the sessions you wanted to backout<br><br>
		<table width="99%" bgcolor="#000000" cellpadding="3" cellspacing="1" ID="Table1">
			<tr bgcolor="#eeeeee">
				<td width="100%" bgcolor="#eeeeee">
					<pre><font color="darkblue">SELECT</font> * <font color="darkblue">FROM</font> t_acc_usage au
<font color="darkblue">WHERE</font> <b>au.id_acc=137 and au.dt_session<'2005-02-01'</b></pre>
				</td>
			</tr>
		</table>
<br>		
Then you would execute the following query to insert these same records into the rerun table<br><br>
		<table width="99%" bgcolor="#000000" cellpadding="3" cellspacing="1" ID="Table2">
			<tr bgcolor="#eeeeee">
				<td width="100%" bgcolor="#eeeeee">
#MDMIF DATABASE_IS_ORACLE
					<pre><code><font color="darkblue">INSERT INTO</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL> (id, id_source_sess, tx_batch, id_sess, id_parent_sess, root, id_interval, id_view, tx_state, id_svc, id_parent_source_sess, id_payer, amount, currency)
<font color="darkblue">SELECT</font>
    seq_t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>.NEXTVAL, <font color="green">-- id (unique id for this entry in this table)</font>
	au.tx_uid, <font color="green">-- id_source_sess</font>
	au.tx_batch, <font color="green">-- tx_batch</font>
	au.id_sess, <font color="green">-- id_sess</font>
	au.id_parent_sess, <font color="green">-- id_parent_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- root</font>
	au.id_usage_interval, <font color="green">-- id_interval</font>
	au.id_view, <font color="green">-- id_view</font>
	<font color="red">'I'</font>, <font color="green">-- tx_state</font>
	au.id_svc, <font color="green">-- id_svc</font>
	<font color="gray">NULL</font>,	<font color="green">-- id_parent_source_sess</font>
	au.id_acc,  <font color="green">-- id_payer</font>
	au.amount,
	au.am_currency
<font color="darkblue">FROM</font> t_acc_usage au
<font color="darkblue">WHERE</font> au.tx_UID <font color="darkblue">NOT IN</font> (<font color="darkblue">SELECT</font> id_source_sess <font color="darkblue">FROM</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>)
and <b>au.id_acc=137</b>
</code></pre>
#MDMENDIF
#MDMIF DATABASE_IS_NOT_ORACLE
					<pre><code><font color="darkblue">INSERT INTO</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL> (id_source_sess, tx_batch, id_sess, id_parent_sess, root, id_interval, id_view, tx_state, id_svc, id_parent_source_sess, id_payer, amount, currency)
<font color="darkblue">SELECT</font> 
	au.tx_uid, <font color="green">-- id_source_sess</font>
	au.tx_batch, <font color="green">-- tx_batch</font>
	au.id_sess, <font color="green">-- id_sess</font>
	au.id_parent_sess, <font color="green">-- id_parent_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- root</font>
	au.id_usage_interval, <font color="green">-- id_interval</font>
	au.id_view, <font color="green">-- id_view</font>
	<font color="red">'I'</font>, <font color="green">-- tx_state</font>
	au.id_svc, <font color="green">-- id_svc</font>
	<font color="gray">NULL</font>,	<font color="green">-- id_parent_source_sess</font>
	au.id_acc,  <font color="green">-- id_payer</font>
	au.amount,
	au.am_currency
<font color="darkblue">FROM</font> t_acc_usage au
<font color="darkblue">WHERE</font> au.tx_UID <font color="darkblue">NOT IN</font> (<font color="darkblue">SELECT</font> id_source_sess <font color="darkblue">FROM</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>)
and <b>au.id_acc=137 and au.dt_session<'2005-02-01'</b>
</code></pre>
#MDMENDIF
				</td>
			</tr>
		</table>					

<br>
<br>
<h3>Failed Transaction Example</h3>	
For example, if the following query selecting failed transactions that are new, happened in a service whose name ends with 'testservice' and were metered before February 2005 represented the sessions you wanted to backout<br><br>
		<table width="99%" bgcolor="#000000" cellpadding="3" cellspacing="1" ID="Table3">
			<tr bgcolor="#eeeeee">
				<td width="100%" bgcolor="#eeeeee">
					<pre><font color="darkblue">SELECT</font>  * <font color="darkblue">FROM</font> t_failed_transaction
<font color="darkblue">WHERE</font> <b>State='N' and tx_FailureServiceName like '%testservice'</b></pre>
				</td>
			</tr>
		</table>
<br>		
Then you would execute the following query to insert these same records into the rerun table<br><br>
		<table width="99%" bgcolor="#000000" cellpadding="3" cellspacing="1" ID="Table4">
			<tr bgcolor="#eeeeee">
				<td width="100%" bgcolor="#eeeeee">
#MDMIF DATABASE_IS_ORACLE
					<pre><font color="darkblue">INSERT INTO</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL> (id, id_source_sess, tx_batch, id_sess, id_parent_sess, root, id_interval, id_view, tx_state, id_svc, id_parent_source_sess)
<font color="darkblue">SELECT</font>
    seq_t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>.NEXTVAL, <font color="green">-- id (unique id for this entry in this table)</font>
	ft.tx_FailureID, <font color="green">--id_source_sess</font>
	case when ft.tx_failureID=ft.tx_FailureCompoundID then ft.tx_batch else NULL end, <font color="green">-- tx_batch</font>
	<font color="gray">NULL</font>, <font color="green">-- id_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- id_parent_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- root</font>
	<font color="gray">NULL</font>, <font color="green">-- id_interval</font>
	<font color="gray">NULL</font>, <font color="green">-- id_view</font>
	<font color="red">'E'</font>, <font color="green">-- tx_state</font>
	ed.id_enum_data, <font color="green">-- id_svc</font>
	case when ft.tx_failureID=ft.tx_FailureCompoundID then NULL else ft.tx_failureCompoundID end <font color="green">-- id_parent_source_sess</font>
<font color="darkblue">FROM</font> t_failed_transaction ft
<font color="darkblue">INNER JOIN</font> t_enum_data ed ON ed.nm_enum_data = ft.tx_FailureServiceName
<font color="darkblue">WHERE</font> (ft.state <> 'R') and (ft.tx_FailureID not in (select id_source_sess from t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>)) and
<b>State='N' and tx_FailureServiceName like '%testservice'</b>
</pre>				
#MDMENDIF
#MDMIF DATABASE_IS_NOT_ORACLE
					<pre><font color="darkblue">INSERT INTO</font> t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL> (id_source_sess, tx_batch, id_sess, id_parent_sess, root, id_interval, id_view, tx_state, id_svc, id_parent_source_sess)
<font color="darkblue">SELECT DISTINCT</font> 
	ft.tx_FailureID, <font color="green">--id_source_sess</font>
	case when ft.tx_failureID=ft.tx_FailureCompoundID then ft.tx_batch else NULL end, <font color="green">-- tx_batch</font>
	<font color="gray">NULL</font>, <font color="green">-- id_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- id_parent_sess</font>
	<font color="gray">NULL</font>, <font color="green">-- root</font>
	<font color="gray">NULL</font>, <font color="green">-- id_interval</font>
	<font color="gray">NULL</font>, <font color="green">-- id_view</font>
	<font color="red">'E'</font>, <font color="green">-- tx_state</font>
	ed.id_enum_data, <font color="green">-- id_svc</font>
	case when ft.tx_failureID=ft.tx_FailureCompoundID then NULL else ft.tx_failureCompoundID end <font color="green">-- id_parent_source_sess</font>
<font color="darkblue">FROM</font> t_failed_transaction ft
<font color="darkblue">INNER JOIN</font> t_enum_data ed ON ed.nm_enum_data = ft.tx_FailureServiceName
<font color="darkblue">WHERE</font> (ft.state <> 'R') and (ft.tx_FailureID not in (select id_source_sess from t_rerun_session_<MDMLABEL Name="ReRunId">%%YOUR_RERUN_ID%%</MDMLABEL>)) and
<b>State='N' and tx_FailureServiceName like '%testservice'</b>
</pre>
#MDMENDIF
				</td>
			</tr>
		</table>					
<br>
<br>

</form>
</body>
</html>
