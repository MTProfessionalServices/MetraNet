<?xml version="1.0" encoding="UTF-8"?>

<priceable_item>
  <name>AudioConfFeature</name>
  <description>Feature Child Priceable Item for Audioconferencing reference implementation</description>
  <item_type>usage</item_type>
  <relationships>
    <parent>AudioConfCall</parent>
  </relationships>
  <parameter_table>metratech.com/featuresetupcharge</parameter_table>
  <parameter_table>metratech.com/metricfeaturerate</parameter_table>
  <parameter_table>metratech.com/timefeaturerate</parameter_table>
  <counters></counters>
  <charges>
	  <charge>
      <name>SetupCharge</name>
      <display_name>Setup Chargesfdasdfa</display_name>
	    <charge_property>
        <name>FeatureType</name>
      </charge_property>
    </charge>
	  <charge>
      <name>TimeBasedCharge</name>
      <display_name>Time Based Charge</display_name>
	    <charge_property>
        <name>FeatureType</name>
      </charge_property>
    </charge>
	  <charge>
      <name>MetricCharge</name>
      <display_name>Metric Charge</display_name>
	    <charge_property>
        <name>FeatureType</name>
      </charge_property>
    </charge>
  </charges>
  <pipeline>
    <service_definition>metratech.com/audioconffeature</service_definition>
    <product_view>metratech.com/audioconffeature</product_view>
  </pipeline>
   <adjustment_type>
    <name>FeatureFlatAdjustment</name>
    <description>Audio Conference Feature Flat Adjustment</description>
    <displayname>Audio Conference Feature Flat Adjustment</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>Y</supportsBulk>
    <formula>
	    <![CDATA[
        Create Procedure DoAdjustmentCalc 
	        -- required inputs
	        @SetupChargeAdjustmentAmount DECIMAL,
	        @TimeBasedChargeAdjustmentAmount DECIMAL,
	        @MetricChargeAdjustmentAmount DECIMAL,
	        -- not required inputs
	        @SetupCharge DECIMAL,
	        @TimeBasedCharge DECIMAL,
	        @MetricCharge DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_SetupCharge DECIMAL OUTPUT,
	        @AJ_TimeBasedCharge DECIMAL OUTPUT,
	        @AJ_MetricCharge DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT
	        as
	        DECLARE @fuzz DECIMAL
          declare @taxratio DECIMAL
          declare @totalcharge DECIMAL
          set @fuzz = 0.0001
          if @SetupCharge > 0.0
						set @AJ_SetupCharge = @SetupChargeAdjustmentAmount
					if @TimeBasedCharge > 0.0
						set @AJ_TimeBasedCharge = @TimeBasedChargeAdjustmentAmount
					if @MetricCharge > 0.0
						set @AJ_MetricCharge = @MetricChargeAdjustmentAmount
				  set @TotalAdjustmentAmount = round((@AJ_SetupCharge + @AJ_TimeBasedCharge + @AJ_MetricCharge), 2)
				  set @totalcharge = @SetupCharge + @TimeBasedCharge + @MetricCharge
					set @taxratio = @TotalAdjustmentAmount/(@totalcharge + @fuzz)
          set @aj_tax_federal = round(@tax_federal * @taxratio, 2)
          set @aj_tax_state = round(@tax_state * @taxratio, 2)
          set @aj_tax_county = round(@tax_county * @taxratio, 2)
          set @aj_tax_local = round(@tax_local * @taxratio, 2)
          set @aj_tax_other = round(@tax_other * @taxratio, 2)
	    ]]>
    </formula>
    <applicabilityrules>
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>RateCorrection</reasoncode>
      <reasoncode>RecordingPoorQuality</reasoncode>
    </reasoncodes>
    <Kind>1</Kind>
    <required_inputs>
      <input_val
        name="SetupChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Setup Charge Adjustment Amount"
      />
      <input_val
        name="TimeBasedChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Time Based Charge Adjustment Amount"
      />
      <input_val
        name="MetricChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Metric Charge Adjustment Amount"
      />
    </required_inputs>
    <outputs>
      <output_val
        name="AJ_SetupCharge"
        type="DECIMAL"
        displayname="Adjustment For Setup Charge"
      />
      <output_val
        name="AJ_TimeBasedCharge"
        type="DECIMAL"
        displayname="Adjustment For Time Based Charge"
      />
      <output_val
        name="AJ_MetricCharge"
        type="DECIMAL"
        displayname="Adjustment For Metric Charge"
      />
       <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
    </outputs>
  </adjustment_type>
   <adjustment_type>
    <name>FeaturePercentAdjustment</name>
    <description>Audio Conference Feature Percent Adjustment</description>
    <displayname>Audio Conference Feature Percent Adjustment</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>Y</supportsBulk>
    <formula>
	    <![CDATA[
       Create Procedure DoAdjustmentCalc
	        -- required inputs
	        @SetupChargeAdjustmentPercent DECIMAL,
	        @TimeBasedChargeAdjustmentPercent DECIMAL,
	        @MetricChargeAdjustmentPercent DECIMAL,
	        -- not required inputs
	        @SetupCharge DECIMAL,
	        @TimeBasedCharge DECIMAL,
	        @MetricCharge DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_SetupCharge DECIMAL OUTPUT,
	        @AJ_TimeBasedCharge DECIMAL OUTPUT,
	        @AJ_MetricCharge DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT
	        as
	        DECLARE @fuzz DECIMAL
          declare @taxratio DECIMAL
          declare @totalcharge DECIMAL
          set @fuzz = 0.0001
	        
          set @AJ_SetupCharge = @SetupCharge * (@SetupChargeAdjustmentPercent * 0.01)
          set @AJ_TimeBasedCharge = @TimeBasedCharge * (@TimeBasedChargeAdjustmentPercent * 0.01)
          set @AJ_MetricCharge = @MetricCharge * (@MetricChargeAdjustmentPercent * 0.01)
          set @TotalAdjustmentAmount = round((@AJ_SetupCharge + @AJ_TimeBasedCharge + @AJ_MetricCharge), 2)
          set @totalcharge = @SetupCharge + @TimeBasedCharge + @MetricCharge
          set @taxratio = @TotalAdjustmentAmount/(@totalcharge + @fuzz)
          set @aj_tax_federal = round(@tax_federal * @taxratio, 2)
          set @aj_tax_state = round(@tax_state * @taxratio, 2)
          set @aj_tax_county = round(@tax_county * @taxratio, 2)
          set @aj_tax_local = round(@tax_local * @taxratio, 2)
          set @aj_tax_other = round(@tax_other * @taxratio, 2)
	    ]]>
    </formula>
    <applicabilityrules>
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>RateCorrection</reasoncode>
      <reasoncode>RecordingPoorQuality</reasoncode>
    </reasoncodes>
    <Kind>2</Kind>
     <required_inputs>
      <input_val
        name="SetupChargeAdjustmentPercent"
        type="DECIMAL"
        displayname="Setup Charge Adjustment Percent"
      />
      <input_val
        name="TimeBasedChargeAdjustmentPercent"
        type="DECIMAL"
        displayname="Time Based Charge Adjustment Percent"
      />
      <input_val
        name="MetricChargeAdjustmentPercent"
        type="DECIMAL"
        displayname="Metric Charge Adjustment Percent"
      />
    </required_inputs>
    <outputs>
      <output_val
        name="AJ_SetupCharge"
        type="DECIMAL"
        displayname="Adjustment For Setup Charge"
      />
      <output_val
        name="AJ_TimeBasedCharge"
        type="DECIMAL"
        displayname="Adjustment For Time Based Charge"
      />
      <output_val
        name="AJ_MetricCharge"
        type="DECIMAL"
        displayname="Adjustment For Metric Charge"
      />
       <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
    </outputs>
  </adjustment_type>
  <adjustment_type>
    <name>RecordFeatureFlatAdjustment</name>
    <description>Audio Conference Record Feature Flat Adjustment</description>
    <displayname>Audio Conference Record Feature Flat Adjustment</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>Y</supportsBulk>
    <formula>
	    <![CDATA[
        Create Procedure DoAdjustmentCalc 
	        -- inputs
	        @SetupChargeAdjustmentAmount DECIMAL,
	        @TimeBasedChargeAdjustmentAmount DECIMAL,
	        @MetricChargeAdjustmentAmount DECIMAL,
	        -- not required inputs
	        @SetupCharge DECIMAL,
	        @TimeBasedCharge DECIMAL,
	        @MetricCharge DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_SetupCharge DECIMAL OUTPUT,
	        @AJ_TimeBasedCharge DECIMAL OUTPUT,
	        @AJ_MetricCharge DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT
	        as
	        DECLARE @fuzz DECIMAL
          declare @taxratio DECIMAL
          declare @totalcharge DECIMAL
          set @fuzz = 0.0001
	        if @SetupCharge > 0.0
						set @AJ_SetupCharge = @SetupChargeAdjustmentAmount
					if @TimeBasedCharge > 0.0
						set @AJ_TimeBasedCharge = @TimeBasedChargeAdjustmentAmount
					if @MetricCharge > 0.0
						set @AJ_MetricCharge = @MetricChargeAdjustmentAmount
          set @TotalAdjustmentAmount = round((@AJ_SetupCharge + @AJ_TimeBasedCharge + @AJ_MetricCharge), 2)
          set @totalcharge = @SetupCharge + @TimeBasedCharge + @MetricCharge
          set @taxratio = @TotalAdjustmentAmount/(@totalcharge + @fuzz)
          set @aj_tax_federal = round(@tax_federal * @taxratio, 2)
          set @aj_tax_state = round(@tax_state * @taxratio, 2)
          set @aj_tax_county = round(@tax_county * @taxratio, 2)
          set @aj_tax_local = round(@tax_local * @taxratio, 2)
          set @aj_tax_other = round(@tax_other * @taxratio, 2)
	    ]]>
    </formula>
    <applicabilityrules>
      <rule>IsRecordFeature</rule>
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>RecordingPoorQuality</reasoncode>
    </reasoncodes>
    <Kind>1</Kind>
    <required_inputs>
      <input_val
        name="SetupChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Setup Charge Adjustment Amount"
      />
      <input_val
        name="TimeBasedChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Time Based Charge Adjustment Amount"
      />
      <input_val
        name="MetricChargeAdjustmentAmount"
        type="DECIMAL"
        displayname="Metric Charge Adjustment Amount"
      />
    </required_inputs>
    <outputs>
      <output_val
        name="AJ_SetupCharge"
        type="DECIMAL"
        displayname="Adjustment For Setup Charge"
      />
      <output_val
        name="AJ_TimeBasedCharge"
        type="DECIMAL"
        displayname="Adjustment For Time Based Charge"
      />
      <output_val
        name="AJ_MetricCharge"
        type="DECIMAL"
        displayname="Adjustment For Metric Charge"
      />
       <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
    </outputs>
  </adjustment_type>
</priceable_item>