<xmlconfig>
  <mtsysconfigdata>
    <effective_date ptype="DATETIME">1998-11-19T00:00:00Z</effective_date>
    <timeout ptype="INTEGER">30</timeout>
    <configfiletype>CONFIG_DATA</configfiletype>
  </mtsysconfigdata>

  <mtconfigdata>

 <version ptype="INTEGER">1</version>
 <!-- First processor configuration -->
 <processor>
  <name>CalcCancellationCharges</name>
  <progid>MetraPipeline.MTSQLInterpreter.1</progid>
  <description>Calculates Cancellation Charges</description>

	<!--
  <autotest>
    <file>cancelcharges.xml</file>
  </autotest>
  -->

  <inputs>
    
  </inputs>

  <outputs>
    
  </outputs>

  <!-- Processor specific configuration data -->
  <configdata>
 
  <Program><![CDATA[
		
			CREATE PROCEDURE calccancelcharges 	@ScheduledConnections INTEGER
																					@CancelRate DECIMAL
																					@CancelMaxCharge	DECIMAL
																					@CancelChargeType ENUM -- $ICE:('metratech.com/audioconfcommon','ChargeType')$
																					@CancelApplicBool	BOOLEAN
																					@CancelCharges	DECIMAL OUTPUT
																					@CancelledFlag	VARCHAR
			AS
			DECLARE @Fixed VARCHAR;
			DECLARE @strChargeType VARCHAR;
			SET @strChargeType = CAST(@CancelChargeType AS VARCHAR)
			SET @CancelCharges = 0.0;
			IF (@CancelApplicBool = FALSE OR @CancelledFlag = 'N' OR @CancelledFlag = 'n')
				RETURN;
			SET @CancelCharges = 
			CASE 
				WHEN (@strChargeType = 'Fixed')
					THEN @CancelRate
				WHEN (@strChargeType = 'PerPort' AND @CancelRate * CAST(@ScheduledConnections AS DECIMAL) >= @CancelMaxCharge)
					THEN @CancelMaxCharge
				WHEN @strChargeType = 'PerPort'
				 	THEN @CancelRate * CAST(@ScheduledConnections AS DECIMAL)
				ELSE
					0.0
				END;
	 
  ]]></Program> 
    
  </configdata>

 </processor>

  </mtconfigdata>

</xmlconfig>
