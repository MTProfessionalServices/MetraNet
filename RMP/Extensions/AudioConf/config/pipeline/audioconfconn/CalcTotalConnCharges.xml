<xmlconfig>
  <mtsysconfigdata>
    <effective_date ptype="DATETIME">1998-11-19T00:00:00Z</effective_date>
    <timeout ptype="INTEGER">30</timeout>
    <configfiletype>CONFIG_DATA</configfiletype>
  </mtsysconfigdata>

  <mtconfigdata>

 <version ptype="INTEGER">1</version>
 <!-- First processor configuration -->
 <processor>
  <name>CalcTotalConnCharges</name>
  <progid>MetraPipeline.MTSQLInterpreter.1</progid>
  <description>Calculates total connection charges</description>

	<!--
  <autotest>
    <file>calcduration.xml</file>
  </autotest>
  -->

  
  <!-- Processor specific configuration data -->
  <configdata>
 
  <Program><![CDATA[
		
		CREATE PROCEDURE calctotalconfconn 	
							@DomesticMTI INTEGER 
							@IntlMTI INTEGER 
							@BridgeMTI INTEGER
							@BaseTransportRate DECIMAL 
							@IntlRate DECIMAL 
							@BridgeRate DECIMAL
							@TollFreeRate DECIMAL 
							@LDRate DECIMAL 
							@BridgeSetupCharge DECIMAL
							@BaseTransportSetupCharge DECIMAL 
							@TransportMinCost DECIMAL 
							@BridgeMinCost DECIMAL
							@Precision INTEGER
							@_Amount DECIMAL OUTPUT
							@IntlAmount DECIMAL OUTPUT
							@BridgeAmount DECIMAL OUTPUT
							@TransportAmount DECIMAL OUTPUT
							@ConnectionMinutes DECIMAL
 						 @IntlMinutes DECIMAL
							@BridgeMinutes DECIMAL
			AS
     
		--	IF (@DomesticMTI=0 OR @IntlMTI=0 OR @BridgeMTI=0 OR @TransportMinCost=0.0 OR         --  @BridgeMinCost=0.0)
				-- log error when supported
	--			RETURN;
			SET @_Amount = @ConnectionMinutes * @BaseTransportRate + @BaseTransportSetupCharge;
                        
			IF (@_Amount < @TransportMinCost)
				SET @_Amount = @TransportMinCost;
			--don't need to check for IsInternational flag, because Rate will be 0
			--if it's not international
			SET @IntlAmount = @IntlMinutes * @IntlRate;

			SET @BridgeAmount = @BridgeMinutes * @BridgeRate + @BridgeSetupCharge;
			IF (@BridgeAmount < @BridgeMinCost)
				SET @BridgeAmount = @BridgeMinCost;
			               
			SET @TransportAmount = @_Amount + @IntlAmount; 
			SET @_Amount = round(@_Amount + @BridgeAmount + @IntlAmount, 2);
			
			PRINT 'Calculated total connnection charges:'
			PRINT 'Connection minutes:'
			PRINT CAST(@ConnectionMinutes AS VARCHAR);
			PRINT 'Base Transport Rate:'
			PRINT CAST(@BaseTransportRate AS VARCHAR);
			PRINT 'Base Transport Setup Charge:'
			PRINT CAST(@BaseTransportSetupCharge AS VARCHAR);
			PRINT 'Preliminary _Amount (@_Amount = @ConnectionMinutes * @BaseTransportRate + @BaseTransportSetupCharge)';
			PRINT CAST(@_Amount AS VARCHAR);
			PRINT 'transport mincost:'
			PRINT CAST(@TransportMinCost AS VARCHAR);
			PRINT 'transport amount:'
			PRINT CAST(@TransportAmount AS VARCHAR);
			PRINT 'bridge amount:'
			PRINT CAST(@BridgeAmount AS VARCHAR);
			PRINT 'intl amount:'
			PRINT CAST(@IntlAmount AS VARCHAR);
			PRINT 'total amount:'
			PRINT CAST(@_Amount AS VARCHAR);
			
      
	
  ]]></Program> 
    
  </configdata>

 </processor>

  </mtconfigdata>

</xmlconfig>

