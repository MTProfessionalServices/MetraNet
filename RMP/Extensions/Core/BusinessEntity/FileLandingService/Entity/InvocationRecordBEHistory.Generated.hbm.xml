<?xml version="1.0"?>
<hibernate-mapping xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" auto-import="false" xmlns="urn:nhibernate-mapping-2.2">
  <meta attribute="category">ConfigDriven</meta>
  <class name="Core.FileLandingService.InvocationRecordBEHistory, Core.FileLandingService.Entity" table="t_be_cor_fil_invocationrec_h">
    <meta attribute="description">A core BME used by FLS.</meta>
    <meta attribute="label" />
    <meta attribute="plural-name">InvocationRecordBEHistorys</meta>
    <meta attribute="database">NetMeter</meta>
    <meta attribute="custom-base-class-name" />
    <meta attribute="record-history">false</meta>
    <meta attribute="entity-type">History</meta>
    <meta attribute="interface">Core.FileLandingService.Interface.IInvocationRecordBEHistory, Core.Interface</meta>
    <meta attribute="metranet-entity-association" />
    <meta attribute="entity-name">Core.FileLandingService.InvocationRecordBE</meta>
    <id name="Id" column="c_InvocationRecordBEHistory_Id">
      <type name="guid" />
      <generator class="guid.comb" />
    </id>
    <version name="_Version" column="c__version" />
    <component class="Core.FileLandingService.InvocationRecordBEBusinessKey, Core.FileLandingService.Entity" name="InvocationRecordBEBusinessKey">
      <meta attribute="business-key">true</meta>
      <meta attribute="internal-business-key">true</meta>
      <property name="InternalKey" column="c_internal_key" not-null="true">
        <meta attribute="label">Internal Business Key</meta>
        <meta attribute="description" />
        <meta attribute="defaultvalue" />
        <meta attribute="sortable">true</meta>
        <meta attribute="searchable">true</meta>
        <meta attribute="association-entity" />
        <meta attribute="encrypted">false</meta>
        <type name="System.Guid" />
      </property>
    </component>
    <property name="CreationDate" column="c_CreationDate">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="Timestamp" />
    </property>
    <property name="UpdateDate" column="c_UpdateDate">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="Timestamp" />
    </property>
    <property name="UID" column="c_UID">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.Int32, mscorlib" />
    </property>
    <property name="InvocationRecordBEId" column="c_InvocationRecordBE_Id" not-null="true">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.Guid, mscorlib" />
    </property>
    <property name="_Command" column="c__Command" length="2000">
      <meta attribute="label">Command  Line</meta>
      <meta attribute="description" />
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.String, mscorlib" />
    </property>
    <property name="_ErrorCode" column="c__ErrorCode" not-null="true">
      <meta attribute="label">Error Code</meta>
      <meta attribute="description">This is the error code if a failure state is recorded</meta>
      <meta attribute="defaultvalue">0</meta>
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.Int64, mscorlib" />
    </property>
    <property name="_State" column="c__State" not-null="true">
      <meta attribute="label">State</meta>
      <meta attribute="description">This is the state</meta>
      <meta attribute="defaultvalue">UNKNOWN</meta>
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="MetraTech.DomainModel.Enums.Core.Metratech_com_FileLandingService.EInvocationState, MetraTech.DomainModel.Enums.Generated" />
    </property>
    <property name="_ControlNumber" column="c__ControlNumber" length="255" not-null="true">
      <meta attribute="label">Control Number</meta>
      <meta attribute="description">This is the control number assigned by the customer.</meta>
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.String, mscorlib" />
    </property>
    <property name="_DateTime" column="c__DateTime" not-null="true">
      <meta attribute="label">Date</meta>
      <meta attribute="description">This is the date and time of the state assignment</meta>
      <meta attribute="defaultvalue">7/14/2006 4:20:06 AM</meta>
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="Timestamp" />
    </property>
    <property name="_BatchId" column="c__BatchId" length="255">
      <meta attribute="label">Batch ID</meta>
      <meta attribute="description">The Batch ID.</meta>
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.String, mscorlib" />
    </property>
    <property name="_TrackingId" column="c__TrackingId" length="255">
      <meta attribute="label">Tracking ID</meta>
      <meta attribute="description">This is the tracking ID.</meta>
      <meta attribute="defaultvalue" />
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="System.String, mscorlib" />
    </property>
    <property name="_StartDate" column="c__StartDate" not-null="true">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue">1/1/0001 12:00:00 AM</meta>
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="Timestamp" />
    </property>
    <property name="_EndDate" column="c__EndDate" not-null="true">
      <meta attribute="label" />
      <meta attribute="description" />
      <meta attribute="defaultvalue">12/31/9999 11:59:59 PM</meta>
      <meta attribute="sortable">true</meta>
      <meta attribute="searchable">false</meta>
      <meta attribute="association-entity" />
      <meta attribute="encrypted">false</meta>
      <meta attribute="computed">false</meta>
      <meta attribute="computation-type-name" />
      <meta attribute="record-history">true</meta>
      <meta attribute="is-custom-base-class-property">false</meta>
      <type name="Timestamp" />
    </property>
  </class>
  <database-object>
    <create>
    IF EXISTS (select * from sys.indexes where name = 'IX_t_be_cor_fil_invocationreco_c__ControlNumber')
	DROP INDEX IX_t_be_cor_fil_invocationreco_c__ControlNumber ON t_be_cor_fil_invocationreco
	
	CREATE NONCLUSTERED INDEX [IX_t_be_cor_fil_invocationreco_c__ControlNumber] ON [dbo].[t_be_cor_fil_invocationreco]
      (
      [c__ControlNumber] ASC
      )
      INCLUDE ( [c_InvocationRecordBE_Id],
      [c__version],
      [c_internal_key],
      [c_CreationDate],
      [c_UpdateDate],
      [c__Command],
      [c__ErrorCode],
      [c__State],
      [c__DateTime],
      [c__BatchId],
      [c__TrackingId])
    </create>
    <drop />
    <dialect-scope name="NHibernate.Dialect.MsSql2008Dialect" />
  </database-object>
  <database-object>
    <create>
	IF EXISTS (select * from sys.stats where name = 'STAT_t_be_cor_fil_invocationreco_1_9')
	DROP STATISTICS t_be_cor_fil_invocationreco.STAT_t_be_cor_fil_invocationreco_1_9
	CREATE STATISTICS [STAT_t_be_cor_fil_invocationreco_1_9] ON [dbo].[t_be_cor_fil_invocationreco]([c_InvocationRecordBE_Id], [c__ControlNumber])
	</create>
    <drop />
    <dialect-scope name="NHibernate.Dialect.MsSql2008Dialect" />
  </database-object>
  <database-object>
    <create>
	IF EXISTS (select * from sys.stats where name = 'STAT_t_be_cor_fil_invocationreco_1_2')
	DROP STATISTICS t_be_cor_fil_invocationreco.STAT_t_be_cor_fil_invocationreco_1_2
	CREATE STATISTICS [STAT_t_be_cor_fil_invocationreco_1_2] ON [dbo].[t_be_cor_fil_invocationreco]([c_InvocationRecordBE_Id], [c__version])
	</create>
    <drop />
    <dialect-scope name="NHibernate.Dialect.MsSql2008Dialect" />
  </database-object>
  <database-object>
    <create>
CREATE or REPLACE 
TRIGGER TRG_InvocationRecordBEHistory
 AFTER INSERT OR UPDATE ON t_be_cor_fil_invocationreco
 REFERENCING NEW AS dataRow 
FOR EACH ROW 
UPDATE t_be_cor_fil_invocationrec_h
 SET c__enddate = :dataRow.c_updatedate 
WHERE c_InvocationRecordBE_Id = :dataRow.c_InvocationRecordBE_Id AND c__enddate = CAST(dbo.mtmaxdate() AS TIMESTAMP); 
INSERT INTO t_be_cor_fil_invocationrec_h
( 
c_internal_key, 
c__version, 
c_creationdate, 
c_updatedate, 
c_uid, 
c_invocationrecordbe_id, 
c__command, 
c__errorcode, 
c__state, 
c__controlnumber, 
c__datetime, 
c__batchid, 
c__trackingid, 
c__startdate, 
c__enddate
) 
VALUES 
( 
:dataRow.c_internal_key, 
:dataRow.c__version, 
:dataRow.c_creationdate, 
:dataRow.c_updatedate, 
:dataRow.c_uid, 
:dataRow.c_invocationrecordbe_id, 
:dataRow.c__command, 
:dataRow.c__errorcode, 
:dataRow.c__state, 
:dataRow.c__controlnumber, 
:dataRow.c__datetime, 
:dataRow.c__batchid, 
:dataRow.c__trackingid, 
:dataRow.c_updatedate, 
CAST(dbo.mtmaxdate() AS TIMESTAMP)
) 
</create>
    <drop />
    <dialect-scope name="NHibernate.Dialect.Oracle10gDialect" />
  </database-object>
  <database-object>
    <create>CREATE TRIGGER TRG_InvocationRecordBEHistory
 ON t_be_cor_fil_invocationreco
 AFTER INSERT, UPDATE 
AS 
SET NOCOUNT ON 
UPDATE history SET c__enddate = ins.c_updatedate 
FROM t_be_cor_fil_invocationrec_h history 
INNER JOIN INSERTED ins ON ins.c_InvocationRecordBE_Id = history.c_InvocationRecordBE_Id
 WHERE history.c__enddate = dbo.mtmaxdate(); 
INSERT INTO t_be_cor_fil_invocationrec_h
(
c_internal_key, 
c__version, 
c_creationdate, 
c_updatedate, 
c_uid, 
c_invocationrecordbe_id, 
c__command, 
c__errorcode, 
c__state, 
c__controlnumber, 
c__datetime, 
c__batchid, 
c__trackingid, 
c__startdate, 
c__enddate
)
SELECT 
c_internal_key, 
c__version, 
c_creationdate, 
c_updatedate, 
c_uid, 
c_invocationrecordbe_id, 
c__command, 
c__errorcode, 
c__state, 
c__controlnumber, 
c__datetime, 
c__batchid, 
c__trackingid, 
c_updatedate, 
dbo.mtmaxdate()
FROM INSERTED;</create>
    <drop />
    <dialect-scope name="NHibernate.Dialect.MsSql2008Dialect" />
  </database-object>
</hibernate-mapping>