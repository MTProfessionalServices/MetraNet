<?xml version="1.0" encoding="utf-8"?>
<xmlconfig>
    <mtsysconfigdata>
        <effective_date ptype="DATETIME">1998-11-19T00:00:00Z</effective_date>
        <timeout ptype="INTEGER">30</timeout>
        <configfiletype>CONFIG_DATA</configfiletype>
    </mtsysconfigdata>
    <mtconfigdata>
        <version ptype="INTEGER">1</version>
        <processor>
            <name>SetDefaults</name>
            <progid>MetraPipeline.MTSQLInterpreter.1</progid>
      <description>
        This plugin is used to set defaults in the GSMServiceAccount creation pipeline, based on the operation being performed.
      </description>

            <!--   <condition>
       </condition> -->
            <configdata>
                <Program><![CDATA[
		CREATE PROCEDURE SetDefaults  @_ServiceID INTEGER 
		                              @Disconnect_Time DATETIME  
		                              @ancestorAccountID INTEGER OUTPUT 
		                              @ancestorAccount VARCHAR(510)
		                              @ancestorAccountNS VARCHAR(80)
		                              @hierarchy_startdate DATETIME OUTPUT 
						                      @payerID INTEGER OUTPUT
						                      @payerAccount VARCHAR(510) OUTPUT
						                      @payerAccountNS VARCHAR(80)OUTPUT
						                      @payment_startdate DATETIME OUTPUT
						                      @_accountID INTEGER
			AS
      	
			IF (CAST(@_ServiceID AS ENUM) = #metratech.com/GSMDisconnect#)
			BEGIN
				PRINT 'Doing a disconnect'
        SET @hierarchy_startdate = @Disconnect_Time;
				SET @ancestorAccountID = -1;
				SET @payerID = -1;
				SET @payment_startdate = @Disconnect_Time;
			END
			
			ELSE IF ((CAST(@_ServiceID AS ENUM) = #metratech.com/GSMConnect#) OR
			         (CAST(@_ServiceID AS ENUM) = #metratech.com/GSMCreateAndConnect#))
			BEGIN
				PRINT 'Doing a connect'
				
				if (NOT (@ancestorAccountID IS NULL))
				  SET @payerID = @ancestorAccountID;
        if (NOT (@ancestorAccount IS NULL))				  
				  SET @payerAccount = @ancestorAccount;
        if (NOT (@ancestorAccountNS IS NULL))				  
				  SET @payerAccountNS = @ancestorAccountNS;
        if (NOT (@hierarchy_startdate IS NULL))				  
				  SET @payment_startdate = @hierarchy_startdate;
			END
				
			

	 ]]></Program>
            </configdata>
        </processor>
    </mtconfigdata>
</xmlconfig>