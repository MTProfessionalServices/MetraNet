<queryfile>
  <mtsysconfigdata>
    <effective_date ptype="DATETIME">1998-11-1T00:00:00Z</effective_date>
    <timeout ptype="INTEGER">30</timeout>
    <configfiletype>CONFIG_DATA</configfiletype>
  </mtsysconfigdata>

  <mtconfigdata>
    <filename>MTSQLSrvr.xml</filename>
    <major>1.0</major>
    <minor>1.0</minor>

    <!-- Account Management Queries -->
    <!-- g. cieplik 4/17/2008 CR 15515 remove single quotes on %%START_DATE%%/%%ISSUER_NUMBER%% these are optional fields, --> 
    <!-- to set these fields to a logical NULL remove quotes and within psaccountmgmt.cpp call "AddParam" with the optional "VARIANT_TRUE" parameter -->
    <query>
      <query_tag>__INSERT_T_PS_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        insert into t_ps_credit_card
          (
            id_payment_instrument,
            n_credit_card_type,
            nm_expirationdt,
            nm_expirationdt_format,
            nm_startdate,
            nm_issuernumber
        ) 
        values
        (
          CAST('%%PAYMENT_INSTRUMENT_ID%%' as UNIQUEIDENTIFIER),
          %%N_CREDIT_CARD_TYPE%%,
          N'%%NM_EXPIRATIONDT%%',
          N'%%NM_EXPIRATIONDT_FORMAT%%',
          N'%%NM_START_DATE%%',
          N'%%NM_ISSUER_NUMBER%%'
	   )
	  ]]>
      </query_string>
      <num_params>6</num_params>
    </query>

 
    <query>
      <query_tag>__INSERT_T_PS_PCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        insert into t_ps_pcard
          (id_acc,
           id_creditcardtype,
           nm_lastfourdigits,
           nm_customerreferenceid,
           nm_customervatnumber,
           nm_companyaddress,
           nm_companypostalcode,
           nm_companyphone,
           nm_reserved1,
           nm_reserved2)
        values
          (%%ACCOUNT_ID%%,
           %%CREDIT_CARD_TYPE%%,
           N'%%LAST_FOUR_DIGITS%%',
           N'%%CUSTOMERREFERENCEID%%',
           N'%%CUSTOMERVATNUMBER%%',
           N'%%COMPANYADDRESS%%',
           N'%%COMPANYPOSTALCODE%%',
           N'%%COMPANYPHONE%%',
           N'%%RESERVED1%%',
           N'%%RESERVED2%%')
	  ]]>
      </query_string>
      <num_params>10</num_params>
    </query>

    <query>
      <query_tag>__INSERT_T_PS_ACH_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        insert into t_ps_ach
          (nm_customer,
           nm_routingnumber,
           nm_accountnumber,
           id_accounttype,
           nm_enabled,
           nm_authreceived,
           nm_validated,
           nm_primary,
           id_acc,
           nm_address,
           nm_city,
           nm_state,
           nm_zip, 
           nm_country, 
           nm_bankname,
           nm_lastfourdigits,
           nm_reserved1,
           nm_reserved2)
        values
          (N'%%CUSTOMER_NAME%%',
           N'%%ROUTINGNUMBER%%',
           N'%%ACCOUNTNUMBER%%',
           %%ACCOUNT_TYPE%%,
           N'%%ENABLED%%',
           N'%%AUTHRECEIVED%%',
           N'%%VALIDATED%%',
           N'%%PRIMARY%%',
           %%ACCOUNT_ID%%,
           N'%%ADDRESS%%',
           N'%%CITY%%',
           N'%%STATE%%',
           N'%%ZIP%%', 
           N'%%COUNTRY%%',
           N'%%BANKNAME%%',
           N'%%LAST_FOUR_DIGITS%%',
           N'%%RESERVED1%%',
           N'%%RESERVED2%%')
	  ]]>
      </query_string>
      <num_params>20</num_params>
    </query>

    <!-- g. cieplik 4/17/2008 CR 15515 remove single quotes on %%START_DATE%%/%%ISSUER_NUMBER%% these are optional fields -->
    <!-- to set these fields to a logical NULL remove quotes and within psaccountmgmt.cpp call "AddParam" with the optional "VARIANT_TRUE" parameter -->
    <query>
      <query_tag>__UPDATE_T_PS_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_creditcard set
          nm_customer            = N'%%CUSTOMER_NAME%%',
          nm_enabled             = N'%%ENABLED%%',
          nm_authreceived        = N'%%AUTHRECEIVED%%',
          nm_address             = N'%%ADDRESS%%',
          nm_city                = N'%%CITY%%',
          nm_state               = N'%%STATE%%',
          nm_zip                 = N'%%ZIP%%',
          nm_country             = N'%%COUNTRY%%', 
          nm_expdate             = N'%%EXP_DATE%%',
          id_expdatef            = %%EXP_DATE_FORMAT%%,
          nm_startdate           = %%START_DATE%%,
          nm_issuernumber        = %%ISSUER_NUMBER%%,
          nm_cardid              = N'%%CARDID%%',
          nm_cardverifyvalue     = N'%%CARD_VERIFY_VALUE%%'
        WHERE 
          id_acc                 = %%ACCOUNT_ID%% and 
          id_creditcardtype      = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits      = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
   </query>

    <query>
      <query_tag>__UPDATE_CREDIT_CARD_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_credit_card set
          n_credit_card_type      = N'%%N_CREDIT_CARD_TYPE%%',
          nm_expirationdt         = N'%%EXP_DATE%%',
          nm_expirationdt_format  = N'%%EXP_DATE_FORMAT%%',
          nm_startdate            = N'%%START_DATE%%',
          nm_issuernumber         = N'%%ISSUER_NUMBER%%'
        WHERE 
          id_payment_instrument  = N'%%PAYMENT_INSTRUMENT_ID%%'
	  ]]>
      </query_string>
      <num_params>12</num_params>
   </query>

    <query>
      <query_tag>__UPDATE_ACH_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
        <![CDATA[
        update t_ps_ach set        
          nm_routing_number = N'%%NM_ROUTING_NUMBER%%',
          nm_bank_name      = N'%%NM_BANK_NAME%%',
          nm_bank_address   = N'%%NM_BANK_ADDRESS%%',
          nm_bank_city      = N'%%NM_BANK_CITY%%',
          nm_bank_state     = N'%%NM_BANK_STATE%%',
          nm_bank_zip       = N'%%NM_BANK_ZIP%%',
          id_country        = %%NM_COUNTRY%%
        WHERE 
          id_payment_instrument  = N'%%PAYMENT_INSTRUMENT_ID%%'          
	  ]]>
      </query_string>
      <num_params>12</num_params>
    </query>

    <query>
      <query_tag>__UPDATE_PS_PAYMENT_INSTRUMENT__</query_tag>
      <query_string>
        <![CDATA[
                update t_ps_payment_instrument set
                    n_payment_method_type = %%N_PAYMENT_METHOD_TYPE%%,
                    nm_account_number = N'%%NM_ACCOUNT_NUMBER%%',
                    nm_first_name = N'%%NM_FIRST_NAME%%',
                    nm_middle_name = N'%%NM_MIDDLE_NAME%%',
                    nm_last_name = N'%%NM_LAST_NAME%%',
                    nm_address1 = N'%%NM_ADDRESS1%%',
                    nm_address2 = N'%%NM_ADDRESS2%%',
                    nm_city = N'%%NM_CITY%%',
                    nm_state = N'%%NM_STATE%%',
                    nm_zip = N'%%NM_ZIP%%',
                    id_country = %%NM_COUNTRY%%
                where 
                  id_payment_instrument  = N'%%PAYMENT_INSTRUMENT_ID%%'
        ]]>
      </query_string>
      <num_params>10</num_params>
    </query>


    <query>
      <query_tag>__UPDATE_AUTHRECEIVED_T_PS_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_creditcard set
          nm_authreceived        = '1'
        where 
          id_acc                 = %%ACCOUNT_ID%% and 
          id_creditcardtype      = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits      = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
   </query>

    <query>
      <query_tag>__UPDATE_EXPDATE_T_PS_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_creditcard set
          nm_expdate            = N'%%EXP_DATE%%'
        WHERE id_acc            = %%ACCOUNT_ID%% and 
              id_creditcardtype = %%CREDIT_CARD_TYPE%% and
              nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
		</query>

    <query>
      <query_tag>__UPDATE_T_PS_PCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_pcard set
          nm_customerreferenceid = N'%%CUSTOMERREFERENCEID%%',
          nm_customervatnumber   = N'%%CUSTOMERVATNUMBER%%',
          nm_companyaddress      = N'%%COMPANYADDRESS%%',
          nm_companypostalcode   = N'%%COMPANYPOSTALCODE%%',
          nm_companyphone        = N'%%COMPANYPHONE%%',
          nm_reserved1           = N'%%RESERVED1%%',
          nm_reserved2           = N'%%RESERVED2%%'
        WHERE 
          id_acc                 = %%ACCOUNT_ID%% and 
          id_creditcardtype      = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits      = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
		</query>

    <query>
      <query_tag>__UPDATE_T_PS_ACH_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_ach set
          nm_customer       = N'%%CUSTOMER_NAME%%',
          nm_enabled        = N'%%ENABLED%%',
          nm_authreceived   = N'%%AUTHRECEIVED%%',
          nm_validated      = N'%%VALIDATED%%',
          nm_address        = N'%%ADDRESS%%',
          nm_city           = N'%%CITY%%',
          nm_state          = N'%%STATE%%',
          nm_zip            = N'%%ZIP%%',
          nm_country        = N'%%COUNTRY%%', 
          nm_bankname       = N'%%BANKNAME%%',
          nm_reserved1      = N'%%RESERVED1%%',
          nm_reserved2      = N'%%RESERVED2%%'
        WHERE 
          id_acc            = %%ACCOUNT_ID%% and 
          nm_routingnumber  = N'%%ROUTINGNUMBER%%' and
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%' and
          id_accounttype    = %%ACCOUNT_TYPE%%
	  ]]>
      </query_string>
      <num_params>4</num_params>
		</query>

    <query>
      <query_tag>__UPDATE_AUTHRECEIVED_T_PS_ACH_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_ach set
          nm_authreceived   = '1'
        where 
          id_acc            = %%ACCOUNT_ID%% and 
          nm_routingnumber  = N'%%ROUTINGNUMBER%%' and
	  id_accounttype    = %%ACCOUNT_TYPE%% and
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>4</num_params>
    </query>

    <query>
      <query_tag>__UPDATE_PRIMARY_IN_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_creditcard set
          nm_primary             = '%%PRIMARY%%'
        WHERE 
          id_acc                 = %%ACCOUNT_ID%% and 
          id_creditcardtype      = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits      = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
		</query>

    <query>
      <query_tag>__UPDATE_PRIMARY_IN_ACH_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        update t_ps_ach set
          nm_primary             = '%%PRIMARY%%'
        WHERE 
          id_acc            = %%ACCOUNT_ID%% and 
          nm_routingnumber  = N'%%ROUTINGNUMBER%%' and 
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%' and
          id_accounttype    = %%ACCOUNT_TYPE%%
	  ]]>
      </query_string>
      <num_params>4</num_params>
		</query>

    <query>
      <query_tag>__DELETE_T_PS_CREDITCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_creditcard
        WHERE 
          id_acc            = %%ACCOUNT_ID%% and 
          id_creditcardtype = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
    </query>

    <query>
      <query_tag>__SELECT_CREDIT_CARD_BY_ACCID_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          id_payment_instrument
        FROM
          t_ps_credit_card
        WHERE 
          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__DELETE_CREDIT_CARD_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
	  <![CDATA[
            
           DELETE FROM
	          t_ps_credit_card
	        WHERE 
	          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	        
          DELETE FROM
	          t_ps_payment_instrument
	        WHERE 
	          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
        
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__DELETE_ACH_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
        <![CDATA[
            
           DELETE FROM
	          t_ps_ach
	        WHERE 
	          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	        
          DELETE FROM
	          t_ps_payment_instrument
	        WHERE 
	          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
        
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>
    
    <query>
      <query_tag>__DELETE_T_PS_CREDITCARD_TABLE_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_creditcard
        WHERE 
          id_acc = %%ACCOUNT_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__DELETE_T_PS_PCARD_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_pcard
        WHERE 
          id_acc            = %%ACCOUNT_ID%% and 
          id_creditcardtype = %%CREDIT_CARD_TYPE%% and
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%'
	  ]]>
      </query_string>
      <num_params>3</num_params>
    </query>

    <query>
      <query_tag>__DELETE_T_PS_PCARD_TABLE_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_pcard
        WHERE 
          id_acc = %%ACCOUNT_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__DELETE_T_PS_ACH_TABLE__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_ach
        WHERE 
          id_acc            = %%ACCOUNT_ID%% and 
          nm_routingnumber  = N'%%ROUTINGNUMBER%%' and 
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%' and
          id_accounttype    = %%ACCOUNT_TYPE%%
	  ]]>
      </query_string>
      <num_params>4</num_params>
    </query>

    <query>
      <query_tag>__DELETE_T_PS_ACH_TABLE_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        delete
          t_ps_ach
        WHERE 
          id_acc = %%ACCOUNT_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__SELECT_BY_NUMBER_TYPE__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          id_acc,
          nm_expdate
        FROM 
          t_ps_creditcard
        WHERE 
          nm_ccnum          = N'%%CREDIT_CARD_NUMBER%%' and 
          id_creditcardtype = %%CREDIT_CARD_TYPE%%
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__SELECT_CC_NUM_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
        nm_account_number,
		    n_credit_card_type
        FROM 
          t_ps_credit_card ps
		  inner join t_ps_payment_instrument ppi on ps.id_payment_instrument = ppi.id_payment_instrument
        WHERE 
          ps.id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__SELECT_PRIMARY_FROM_CREDITCARD__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          nm_lastfourdigits,
          id_creditcardtype
        FROM 
          t_ps_creditcard
        WHERE 
          id_acc            =  %%ACCOUNT_ID%% and 
          nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%' and
          id_creditcardtype = %%CREDIT_CARD_TYPE%% and
          nm_primary        =  N'%%PRIMARY%%'
	  ]]>
      </query_string>
      <num_params>4</num_params>
    </query>

    <query>
      <query_tag>__SELECT_PRIMARY_FROM_CREDITCARD_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          nm_lastfourdigits,
          id_creditcardtype
        FROM 
          t_ps_creditcard
        WHERE 
          id_acc            =  %%ACCOUNT_ID%% and 
          nm_primary        =  N'%%PRIMARY%%'
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__SELECT_PRIMARY_FROM_ACH__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          nm_routingnumber,
          nm_lastfourdigits,
          id_accounttype
        FROM 
          t_ps_ach
        WHERE 
          id_acc            =  %%ACCOUNT_ID%% and 
          nm_routingnumber  =  N'%%ROUTINGNUMBER%%' and
          nm_lastfourdigits =  N'%%LAST_FOUR_DIGITS%%' and
          id_accounttype    =  %%ACCOUNT_TYPE%% and 
          nm_primary        =  N'%%PRIMARY%%'
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__SELECT_PRIMARY_FROM_ACH_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          nm_routingnumber,
          nm_lastfourdigits,
          id_accounttype
        FROM 
          t_ps_ach
        WHERE 
          id_acc            =  %%ACCOUNT_ID%% and 
          nm_primary        =  N'%%PRIMARY%%'
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__SELECT_BY_ID_CCTYPE_LAST4__</query_tag>
      <query_string>
	  <![CDATA[
            select ppi.id_payment_instrument from t_ps_credit_card cc
            inner join t_ps_payment_instrument ppi on cc.id_payment_instrument = ppi.id_payment_instrument
            where nm_account_number = N'%%NM_ACCOUNT_NUMBER%%'
	  ]]>
  </query_string>
  <num_params>1</num_params>
</query>

<query>
  <query_tag>__SELECT_BY_ID_ACHTYPE_LAST4__</query_tag>
  <query_string>
    <![CDATA[
        SELECT
          tpach.id_acc,
          tpach.nm_customer,
          tpach.nm_routingnumber,
          tpach.nm_accountnumber,
          tpach.id_accounttype,
          tpach.id_acc,
          tpach.nm_primary,
          tpach.nm_enabled,
          tpach.nm_authreceived,
          tpach.nm_validated,
          tpach.nm_address,
          tpach.nm_city,
          tpach.nm_state,
          tpach.nm_zip, 
          tpach.nm_country, 
          tpach.nm_bankname,
          tpach.nm_lastfourdigits,
          tpach.nm_reserved1,
          tpach.nm_reserved2
        FROM 
          t_ps_ach     tpach
        WHERE 
          tpach.id_acc            = %%ACCOUNT_ID%% and 
          tpach.nm_routingnumber  = N'%%ROUTINGNUMBER%%' and
          tpach.nm_lastfourdigits = N'%%LAST_FOUR_DIGITS%%' and
          tpach.id_accounttype    = %%ACCOUNT_TYPE%%
	  ]]>
  </query_string>
  <num_params>4</num_params>
</query>

    <query>
      <query_tag>__SELECT_ALL_CC_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          nm_lastfourdigits,
          nm_bankname,
          id_creditcardtype,
          nm_expdate,
          id_expdatef
        FROM 
          t_ps_credit_card
        WHERE 
          id_acc = %%ACCOUNT_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
      <query_tag>__SELECT_ALL_ACH_BY_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          tpach.nm_routingnumber,
          tpach.nm_lastfourdigits,
          tpach.id_accounttype,
          tpach.nm_bankname
        from
          t_ps_ach tpach
        WHERE 
          tpach.id_acc = %%ACCOUNT_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <!-- transaction id to terminal id mapping queries -->

    <query>
      <query_tag>__GET_XACTIONTERMIDMAP__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT
          * 
        FROM t_xactiontermidmap
          WHERE nm_xactiontermidmap = %%XACTION_ID%%
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

    <query>
	<query_tag>__INSERT_TO_XACTIONTERMIDMAP</query_tag>
	<query_string>
	  <![CDATA[
        insert into t_xactiontermidmap (
		nm_xactionid,
        id_termid)
		values (
		%%XACTION_ID%%, 
        %%TERMINAL_ID%%)
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <!-- payment audit table queries -->

    <query>
	<query_tag>__INSERT_TO_PAYMENT_AUDIT__</query_tag>
	<query_string>
	  <![CDATA[
        insert into t_payment_audit (
		id_acc, 
		nm_action, 
	   	nm_routingnumber, 
		nm_lastfourdigits, 
		nm_accounttype, 
		nm_bankname, 
		nm_expdate, 
	    id_expdatef, 
		tx_IP_subscriber,
		tx_phone_number,
		tx_IP_CSR,
		id_CSR,
		tx_notes)
		values (
		%%ACCOUNT_ID%%,
		N'%%ACTION_NAME%%',
		N'%%ROUTING_NUMBER%%',
		N'%%LAST_FOUR_DIGITS%%',
		N'%%ACCOUNT_TYPE%%',
		N'%%BANK_NAME%%',
		N'%%EXP_DATE%%',
		%%EXP_DATE_FORMAT%%,
		N'%%SUBSCRIBER_IP%%',
		N'%%PHONE_NUNBER%%',
		N'%%CSR_IP%%',
		N'%%CSR_ID%%',
		N'%%NOTES%%')
	  ]]>
      </query_string>
      <num_params>13</num_params>
    </query>

    <!-- t_preauthorizationlist queries -->

    <query>
      <query_tag>__INSERT_TO_PREAUTHORIZATIONLIST__</query_tag>
      <query_string>
	  <![CDATA[
        insert into t_preauthorizationlist
          (id_acc, 
           nm_xactionid, 
           nm_intxactionid,
           nm_lastfourdigits,
           id_creditcardtype) 
        values
          (%%ACCOUNT_ID%%,
           N'%%XACTION_ID%%',
           N'%%INT_XACTION_ID%%',
           N'%%LAST_FOUR_DIGITS%%',
           %%CREDIT_CARD_TYPE%%)
	  ]]>
      </query_string>
      <num_params>3</num_params>
    </query>

    <query>
      <query_tag>__GET_XACTION_ID__</query_tag>
      <query_string>
	  <![CDATA[
        SELECT 
		  *
        FROM 
		  t_preauthorizationlist
        WHERE 
		  id_acc = %%ACCOUNT_ID%% and
          nm_intxactionid = N'%%INT_XACTION_ID%%'
	  ]]>
      </query_string>
      <num_params>2</num_params>
    </query>

    <query>
      <query_tag>__DELETE_PREAUTHORIZATIONLIST_BY_XACTIONID__</query_tag>
      <query_string>
	  <![CDATA[
        delete t_preauthorizationlist
        WHERE nm_xactionid = N'%%XACTION_ID%%'
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>

	<query>
      <query_tag>__UPDATE_ACH_CREDIT_RECORD__</query_tag>
      <query_string>
		<![CDATA[
		UPDATE t_pv_ps_ach_credit 
		SET c_currentstatus = %%PAYMENT_STATUS%% 
		WHERE c_paymentservicetransactionid='%%PS_TRANSACTION_ID%%'
		]]>
      </query_string>
      <num_params>3</num_params>
	</query>

	<query>
      <query_tag>__UPDATE_ACH_DEBIT_RECORD__</query_tag>
      <query_string>
		<![CDATA[
		UPDATE t_pv_ps_ach_debit 
		SET c_currentstatus = %%PAYMENT_STATUS%% 
		WHERE c_paymentservicetransactionid='%%PS_TRANSACTION_ID%%'
		]]>
      </query_string>
      <num_params>3</num_params>
	</query>
	
	<query>
      <query_tag>__LOAD_PAYMENT_METHOD_TYPE__</query_tag>
      <query_string>
		<![CDATA[
		select 
			n_payment_method_type,
			nm_account_number,
			nm_first_name,
			nm_middle_name,
			nm_last_name,
			nm_address1,
			nm_address2,
			nm_city,
			nm_state,
			nm_zip,
			id_country      
		from t_ps_payment_instrument
		where id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
		]]>
      </query_string>
      <num_params>1</num_params>
	</query>

    <query>
      <query_tag>__SELECT_ALL_CC_DATA__</query_tag>
      <query_string>
        <![CDATA[
                select    
                  id_payment_instrument,
                  n_credit_card_type,
                  nm_expirationdt,	
                  nm_expirationdt_format,
                  nm_startdate,
                  nm_issuernumber
                from t_ps_credit_card
                where id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	             ]]>
                </query_string>
                <num_params>1</num_params>
    </query>
	
    <query>
      <query_tag>__INSERT_INTO_T_PS_AUDIT__</query_tag>
      <query_string>
        <![CDATA[
        insert into t_ps_audit
          (
          id_audit,
          id_request_type,
          id_transaction,
          dt_transaction,
          n_payment_method_type,
          nm_truncd_acct_num,
          n_creditcard_type,
          n_account_type,
          nm_description,
          n_currency,
          n_amount,
          id_transaction_session_id,
          n_state,
          n_gateway_response,
          dt_last_update
          ) 
			  values
          (
          @id_audit,
          @id_request_type,
          @id_transaction,
          @dt_transaction,
          @n_payment_method_type,
          @nm_truncd_acct_num,
          @n_creditcard_type,
          @n_account_type,
          @nm_description,
          @n_currency,
          @n_amount,
          @id_transaction_session_id,
          @n_state,
          NULL,
          %%%SYSTEMDATE%%%
          )         
        ]]>
      </query_string>
      <num_params>14</num_params>
    </query>
	
      <query>
          <query_tag>__UPDATE_PS_TRANSACTION_STATUS__</query_tag>
          <query_string>
              <![CDATA[
              update t_ps_audit
              set n_state = @n_state, dt_last_update = %%%SYSTEMDATE%%%, n_gateway_response=@n_gateway_response
              where id_transaction_session_id = @id_transaction]]>
          </query_string>
      </query>
 
      <query>
        <query_tag>__GET_PS_TRANSACTION_STATUS__</query_tag>
        <query_string>
          <![CDATA[
              select n_state from t_ps_audit
              where id_transaction_session_id = @id_transaction]]>
        </query_string>
      </query>
 
    <query>
      <query_tag>__INSERT_INTO_T_PS_AUDIT_DETAILS__</query_tag>
      <query_string>
        <![CDATA[
        insert into t_ps_audit_details
          (
		  id_audit_detail,
          id_audit,
          nm_invoice_num,
          dt_invoice_date,
          nm_po_number,
		  n_amount
          ) 
			  values
          ( ?, ?, ?, ?, ?, ? )
        ]]>
      </query_string>
      <num_params>14</num_params>
    </query>
	
	
    <query>
      <query_tag>__INSERT_INTO_T_PS_PREAUTH__</query_tag>
      <query_string>
        <![CDATA[
        insert into t_ps_preauth
          (
	          id_preauth_tx_id,
	          id_pymt_instrument,
	          dt_transaction,
	          nm_description,
	          n_currency,
	          n_amount,
			  n_request_params,
			  nm_ar_request_id
          ) 
			  values
          (
           N'%%ID_PREAUTH_TX_ID%%',
           N'%%ID_PYMT_INTRUMENT%%',
           %%DT_TRANSACTION%%,
           SUBSTRING(N'%%NM_DESCRIPTION%%', 1, 10),
           N'%%N_CURRENCY%%',
           %%N_AMOUNT%%,
           N'%%N_REQUEST_PARAMS%%',
		   N'%%NM_AR_REQUEST_ID%%'
          )         
        ]]>
      </query_string>
      <num_params>10</num_params>
    </query>
	
    <query>
      <query_tag>__INSERT_INTO_T_PS_PREAUTH_DETAILS__</query_tag>
      <query_string>
        <![CDATA[
        insert into t_ps_preauth_details
          (
			  id_preauth_tx_id_detail,
	          id_preauth_tx_id,
	          nm_invoice_num,
	          dt_invoice_date,
	          nm_po_number,
			  n_amount
		  ) 
			  values
          (
		   ?, ?, ?, ?, ?, ?
          )    
        ]]>
      </query_string>
      <num_params>10</num_params>
    </query>
	
    <query>
      <query_tag>__LOAD_PREAUTH_RECORD__</query_tag>
      <query_string>
        <![CDATA[
            select 
              id_pymt_instrument,
	            n_request_params,
				nm_ar_request_id,
				n_amount
            from t_ps_preauth
            where id_preauth_tx_id = N'%%AUTH_TOKEN%%'
        ]]>
      </query_string>
      <num_params>9</num_params>
    </query>
    <query>
      <query_tag>__DELETE_PREAUTH_RECORD__</query_tag>
      <query_string>
        <![CDATA[
			delete from t_ps_preauth_details where id_preauth_tx_id = N'%%ID_PREAUTH_TX_ID%%';
            delete from t_ps_preauth where id_preauth_tx_id = N'%%ID_PREAUTH_TX_ID%%';
        ]]>
      </query_string>
      <num_params>9</num_params>
    </query>
    <query>
      <query_tag>__STORE_PAYMENT_INSTRUMENT__</query_tag>
      <query_string>
        <![CDATA[
                INSERT INTO t_ps_payment_instrument
                  (
                    id_payment_instrument,
                    n_payment_method_type,
                    nm_account_number,
                    nm_first_name,
                    nm_middle_name,
                    nm_last_name,
                    nm_address1,
                    nm_address2,
                    nm_city,
                    nm_state,
                    nm_zip,
                    id_country
                  )
                  VALUES
                  (
                    N'%%PAYMENT_INSTRUMENT_ID%%',
                    %%N_PAYMENT_METHOD_TYPE%%,
                    N'%%NM_ACCOUNT_NUMBER%%',
                    N'%%NM_FIRST_NAME%%',
                    N'%%NM_MIDDLE_NAME%%',
                    N'%%NM_LAST_NAME%%',
                    N'%%NM_ADDRESS1%%',
                    N'%%NM_ADDRESS2%%',
                    N'%%NM_CITY%%',
                    N'%%NM_STATE%%',
                    N'%%NM_ZIP%%',
                    %%NM_COUNTRY%%
                  )
        ]]>
      </query_string>
      <num_params>10</num_params>
    </query>
    <query>
      <query_tag>__SELECT_ACH_DETAILS_BY_PAYMENT_INSTRUMENT_ID__</query_tag>
      <query_string>
        <![CDATA[
        select
	        id_payment_instrument,
          nm_routing_number,
          nm_bank_name,
          nm_bank_address,
          nm_bank_city,
          nm_bank_state,
          nm_bank_zip,
          id_country
        from t_ps_ach
        WHERE 
          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>
    <query>
      <query_tag>__INSERT_T_PS_ACH__</query_tag>
      <query_string>
        <![CDATA[
        insert into t_ps_ach
          (
            id_payment_instrument,
            nm_routing_number,
            nm_bank_name,
            nm_bank_address,
            nm_bank_city,
            nm_bank_state,
            nm_bank_zip,
            id_country
        ) 
        values
        (
          CAST('%%PAYMENT_INSTRUMENT_ID%%' as UNIQUEIDENTIFIER),
          N'%%NM_ROUTING_NUMBER%%',
          N'%%NM_BANK_NAME%%',
          N'%%NM_BANK_ADDRESS%%',
          N'%%NM_BANK_CITY%%',
          N'%%NM_BANK_STATE%%',
          N'%%NM_BANK_ZIP%%',
          %%NM_COUNTRY%%
	   )
	  ]]>
      </query_string>
      <num_params>8</num_params>
    </query>

    <query>
      <query_tag>__GET_PAYMENT_METHOD_TYPE__</query_tag>
      <query_string>
        <![CDATA[
            
           SELECT n_payment_method_type FROM
	          t_ps_payment_instrument
	        WHERE 
	          id_payment_instrument = N'%%PAYMENT_INSTRUMENT_ID%%'
        
	  ]]>
      </query_string>
      <num_params>1</num_params>
    </query>
  </mtconfigdata>
</queryfile>
