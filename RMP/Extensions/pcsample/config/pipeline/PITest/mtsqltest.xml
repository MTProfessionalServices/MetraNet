<?xml version="1.0" encoding="utf-8"?>
<xmlconfig>
    <mtsysconfigdata>
        <effective_date ptype="DATETIME">1998-11-19T00:00:00Z</effective_date>
        <timeout ptype="INTEGER">30</timeout>
        <configfiletype>CONFIG_DATA</configfiletype>
    </mtsysconfigdata>
    <mtconfigdata>
        <version ptype="INTEGER">1</version>
        <!-- First processor configuration -->
        <processor>
            <name>mtsqltest</name>
            <progid>MetraPipeline.MTSQLInterpreter.1</progid>

            <autotest>
                <file>mtsqlautotest.xml</file>
            </autotest>
            <!--
  <inputs>
  </inputs>

  <outputs>
  </outputs>
-->
            <!-- Processor specific configuration data -->
            <configdata>
                <Program><![CDATA[
CREATE PROCEDURE audioconf @Units DOUBLE @Duration INTEGER @Rate DECIMAL @MTI INTEGER @MinCharge DECIMAL @SetupCharge DECIMAL @_Amount DECIMAL OUTPUT @time DATETIME @_Timestamp DATETIME OUTPUT @DecProp4Applic BOOLEAN @DecProp4 DECIMAL OUTPUT
AS
DECLARE @RoundedDuration DECIMAL;
-- Calculate the duration rounded by the MTI
DECLARE @timeMod INTEGER;
DECLARE @timeDiv INTEGER;
SET @timeMod = @Duration % @MTI;
SET @timeDiv = @Duration / @MTI;
SET @timeDiv = CASE WHEN @timeMod > 0 OR @timeDiv = 0 THEN @timeDiv + 1 ELSE @timeDiv END;
SET @RoundedDuration = (CAST(@timeDiv AS DECIMAL) * CAST(@MTI AS DECIMAL))/ 60.0;
--PRINT '@RoundedDuration =' + CAST(@RoundedDuration AS VARCHAR);

-- Calculate the usage
DECLARE @UsageCharge DECIMAL;
SET @UsageCharge = @Rate*@RoundedDuration;
--PRINT '@UsageCharge =' + CAST(@UsageCharge AS VARCHAR);
-- Set charges to be the setup + usage
SET @_Amount = @SetupCharge + @UsageCharge;
--PRINT '@_Amount =' + CAST(@_Amount AS VARCHAR);
-- Enforce the minimum charge
SET @_Amount = CASE WHEN @_Amount <= @MinCharge THEN @MinCharge ELSE @_Amount END;
-- Set the timestamp from the metered in time value (this becomes dt_session)
SET @_Timestamp = @time;

-- Set the value of DecProp4 based on @DecProp4Applic (the latter comes from a parameter table)
IF (@DecProp4Applic = TRUE) SET @DecProp4 = 999.99
	  ]]></Program>
            </configdata>
        </processor>
    </mtconfigdata>
</xmlconfig>