
%%INSERT_INTO_CLAUSE%%
select 
/* __PREPROCESS_GROUP_SUBSCRIPTION_PARTICIPATIONS_FOR_NRC__ */
s.id_po, gsm1.id_acc, s.id_sub, gsm1.vt_start, gsm1.vt_end, gsm1.tt_start, gsm1.tt_end, 
/*  This query lists the historical record of participations with an indication of  */
/*  whether this is someone's first, second, etc. participation.  This knowledge is */
/*  required when I check to see whether a NRC for a participation record has been */
/*  generated by a previous run of the adapter.  Absent a nice surrogate key for participation */
/*  records, I fudge one by ordering them. */
dbo.MTMaxOfTwoDates(gsm1.vt_start, gsm1.tt_start) as max_vt_tt_start, 
dbo.MTMaxOfTwoDates(gsm1.vt_end, gsm1.tt_start) as max_vt_tt_end, 
count(*) position 
%%INTO_CLAUSE%%
from t_gsubmember_historical gsm1
inner join t_sub s on gsm1.id_group=s.id_group
inner join t_gsubmember_historical gsm2 on gsm1.id_group=gsm2.id_group and gsm1.id_acc=gsm2.id_acc and gsm1.tt_start <= gsm2.tt_end and gsm2.tt_start <= gsm1.tt_end 
/*  This next clause of the predicate takes all of the records that "preceed" the current one. */
and gsm1.vt_start >= gsm2.vt_start
group by s.id_po, gsm1.id_acc, s.id_sub, gsm1.vt_start, gsm1.vt_end, gsm1.tt_start, gsm1.tt_end
  		