<?xml version="1.0" encoding="UTF-8"?>

<migration name="alltariffs" xsi:schemalocation="http://localhost/validation/migration_1_0.xsd" xmlns:xsi="http://www.w3.org/1999/XMLSchema/instance">
	<version major="1" minor="1">
		<translation_mechanism>VBS</translation_mechanism>
		<action>
			<![CDATA[

				function TranslateFile(inputfile,outputfile)

					const PROP_TYPE_STRING = 4
					const PROP_TYPE_ENUM = 10

					'Create the tariff object '
					set aTariffCol = CreateObject("MTTariffCollection.MTTariffCollection.1")
					set aMtConfig = CreateObject("MetraTech.MTConfig.1")
					set aModuleReader = CreateObject("MTModule.MTModule.1")
					set aRCD = CreateObject("MetraTech.Rcd")

					set aPropSet = aMtConfig.NewConfiguration("xmlconfig")

					'intialize the modulereader '
					aModuleReader.AbsolutePath = true
					aModuleReader.ModuleDataFileName = inputfile
					' read the file '
					call aModuleReader.Read()
					' initialize the tariff collection '
					call aTariffCol.Read(aModuleReader)

					' initialize the attrib set.  We reuse this during the loop '
					set aAttribSet = CreateObject("MetraTech.MTConfigAttribSet.1")
					call aAttribSet.initialize()
					aAttribSet.AddPair "enumspace","metratech.com/accountcreation"
					aAttribSet.AddPair "enumtype","TariffID"

					for each Tariff in aTariffCol
						' create the tariff entry in the file '
						set aTariffSet = aPropSet.InsertSet("tariff")

						set aNameProp = CreateObject("MetraTech.MTConfigProp.1")
						aNameProp.name = "Name"
						aNameProp.AddProp PROP_TYPE_ENUM,Tariff.Name
						aNameProp.AttribSet = aAttribSet
						atariffSet.InsertConfigProp aNameProp
						atariffSet.InsertProp "Description",PROP_TYPE_STRING,Tariff.Description
						atariffSet.InsertProp "Currency",PROP_TYPE_STRING,Tariff.Currency
					next

					aPropSet.Write outputfile
				end function

			]]>
		</action>
	</version>

</migration>