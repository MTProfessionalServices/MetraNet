<?xml version="1.0" encoding="UTF-8"?>

<priceable_item>
  <name>AudioConfCall</name>
  <description>Parent Priceable Item for Audioconferencing reference implementation</description>
  <item_type>usage</item_type>
  <relationships>
    <parent></parent>
    <child>AudioConfConn</child>
    <child>AudioConfFeature</child>
  </relationships>
  <parameter_table>metratech.com/cancelapplic</parameter_table>
  <parameter_table>metratech.com/minapplic</parameter_table>
  <parameter_table>metratech.com/reservationapplic</parameter_table>
  <parameter_table>metratech.com/unusedportapplic</parameter_table>
  <parameter_table>metratech.com/overusedportapplic</parameter_table>
  <parameter_table>metratech.com/overusedportdef</parameter_table>
  <parameter_table>metratech.com/unusedportdef</parameter_table>
  <parameter_table>metratech.com/mincharge</parameter_table>
  <parameter_table>metratech.com/cancelrate</parameter_table>
  <parameter_table>metratech.com/reserverate</parameter_table>
  <parameter_table>metratech.com/unusedportrate</parameter_table>
  <parameter_table>metratech.com/overusedportrate</parameter_table>
  <counters></counters>
  <charges>
	<charge>
  <name>UnusedPortCharges</name>
  <display_name>Unused Port Charge</display_name>
  </charge>
	<charge>
  <name>OverusedPortCharges</name>
  <display_name>Overused Port Charge</display_name>
  </charge>
	<charge>
  <name>CancelCharges</name>
  <display_name>Cancellation Charge</display_name>
  </charge>
	<charge>
  <name>ReservationCharges</name>
  <display_name>Reservation Charge</display_name>
  </charge>
  </charges>
  <pipeline>
    <service_definition>metratech.com/audioconfcall</service_definition>
    <product_view>metratech.com/audioconfcall</product_view>
  </pipeline>
  <adjustment_type>
    <name>CallFlatAdjustment</name>
    <description>Audio Conference Call Flat Adjustment</description>
    <displayname>Audio Conference Call Flat Adjustment Display</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>N</supportsBulk>
    <DefaultAdjustmentDescription>
    <![CDATA[
      Flat Adjustment for Conference call '@ConferenceID'(@ConferenceName)
     ]]>
    </DefaultAdjustmentDescription>
    <formula>
	    <![CDATA[
       Create Procedure DoAdjustmentCalculation
	        -- required inputs
	        @UnusedPortChargesAdjustmentAmount DECIMAL,
	        @OverusedPortChargesAdjustmentAmount DECIMAL,
	        @CancelChargesAdjustmentAmount DECIMAL,
	        @ReservationChargesAdjustmentAmount DECIMAL,
	        -- non required inputs 
	        @UnusedPortCharges DECIMAL,
	        @OverusedPortCharges DECIMAL,
	        @CancelCharges DECIMAL,
	        @ReservationCharges DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_UnusedPortCharges DECIMAL OUTPUT,
	        @AJ_OverusedPortCharges DECIMAL OUTPUT
	        @AJ_CancelCharges DECIMAL OUTPUT,
	        @AJ_ReservationCharges DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT
	        as
	        DECLARE @fuzz DECIMAL
	        declare @taxratio DECIMAL
          declare @totalcharge DECIMAL
          set @fuzz = 0.0001
          if @UnusedPortCharges > 0.0
						set @AJ_UnusedPortCharges = round(@UnusedPortChargesAdjustmentAmount, 2)
          if @OverusedPortCharges > 0.0
						set @AJ_OverusedPortCharges = round(@OverusedPortChargesAdjustmentAmount, 2)
					if @CancelCharges > 0.0
						set @AJ_CancelCharges = round(@CancelChargesAdjustmentAmount, 2)
					if @ReservationCharges > 0.0
						set @AJ_ReservationCharges = round(@ReservationChargesAdjustmentAmount, 2)
          set @totalcharge = @UnusedPortCharges + @OverusedPortCharges + @CancelCharges + @ReservationCharges
          set @TotalAdjustmentAmount = 
          round((@AJ_UnusedPortCharges + @AJ_OverusedPortCharges + @AJ_CancelCharges + @AJ_ReservationCharges), 2)
          set @taxratio = @TotalAdjustmentAmount/(@totalcharge + @fuzz)
          set @aj_tax_federal = round(@tax_federal * @taxratio, 2)
          set @aj_tax_state = round(@tax_state * @taxratio, 2)
          set @aj_tax_county = round(@tax_county * @taxratio, 2)
          set @aj_tax_local = round(@tax_local * @taxratio, 2)
          set @aj_tax_other = round(@tax_other * @taxratio, 2)
      ]]>
    </formula>
    <applicabilityrules>
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>Bankruptcy</reasoncode>
      <reasoncode>RateCorrection</reasoncode>
    </reasoncodes>
    <Kind>1</Kind>
    
    <required_inputs>
      <input_val
        name="UnusedPortChargesAdjustmentAmount"
        type="DECIMAL"
        displayname="Adjustment Amount for Unused Port Charges"
      />
       <input_val
        name="OverusedPortChargesAdjustmentAmount"
        type="DECIMAL"
        displayname="Adjustment Amount for Overused Port Charges"
      />
      <input_val
        name="CancelChargesAdjustmentAmount"
        type="DECIMAL"
        displayname="Adjustment Amount for Cancellation Charges"
      />
      <input_val
        name="ReservationChargesAdjustmentAmount"
        type="DECIMAL"
        displayname="Adjustment Amount for Reservation Charges"
      />
    </required_inputs>
   
    <outputs>
      <output_val
        name="AJ_UnusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Unused Port Charge"
      />
       <output_val
        name="AJ_OverusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Overused Port Charge"
      />
       <output_val
        name="AJ_CancelCharges"
        type="DECIMAL"
        displayname="Adjustment For Cancellation Charges"
      />
       <output_val
        name="AJ_ReservationCharges"
        type="DECIMAL"
        displayname="Adjustment For Reservation Charges"
      />
      <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Charge Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
     </outputs>
   </adjustment_type>
   <adjustment_type>
    <name>CallPercentAdjustment</name>
    <description>Audio Conference Call Percentage Adjustment</description>
    <displayname>Audio Conference Call Percentage Adjustment Display</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>N</supportsBulk>
    <DefaultAdjustmentDescription>
    <![CDATA[
      Percent Adjustment for Audio Conference call with ID: '@ConferenceID', 
      Name: '@ConferenceName', Start Time: '@ActualStartTime'
     ]]>
    </DefaultAdjustmentDescription>
    <formula>
	    <![CDATA[
      Create Procedure DoAdjustmentCalc
	        -- required inputs
	        @UnusedPortChargesPercent DECIMAL
	        @OverusedPortChargesPercent DECIMAL
	        @CancelChargesPercent DECIMAL,
	        @ReservationChargesPercent DECIMAL,
	        -- non required inputs
	        @UnusedPortCharges DECIMAL,
	        @OverusedPortCharges DECIMAL,
	        @CancelCharges DECIMAL,
	        @ReservationCharges DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_UnusedPortCharges DECIMAL OUTPUT,
	        @AJ_OverusedPortCharges DECIMAL OUTPUT
	        @AJ_CancelCharges DECIMAL OUTPUT,
	        @AJ_ReservationCharges DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT
	        as
	        DECLARE @fuzz DECIMAL
          declare @taxratio DECIMAL
          declare @totalcharge DECIMAL
          set @fuzz = 0.0001
	        set @AJ_UnusedPortCharges = round(@UnusedPortCharges * (@UnusedPortChargesPercent * 0.01), 2)
          set @AJ_OverusedPortCharges =  round(@OverusedPortCharges * (@OverusedPortChargesPercent * 0.01), 2)
          set @AJ_CancelCharges =  round(@CancelCharges * (@CancelChargesPercent * 0.01), 2)
          set @AJ_ReservationCharges =  round(@ReservationCharges * (@ReservationChargesPercent * 0.01), 2)
          set @totalcharge = @UnusedPortCharges + @OverusedPortCharges + @CancelCharges + @ReservationCharges
          set @TotalAdjustmentAmount = 
          round((@AJ_UnusedPortCharges + @AJ_OverusedPortCharges + @AJ_CancelCharges + @AJ_ReservationCharges), 2)
          set @taxratio = @TotalAdjustmentAmount/(@totalcharge + @fuzz)
          set @aj_tax_federal = round(@tax_federal * @taxratio, 2)
          set @aj_tax_state = round(@tax_state * @taxratio, 2)
          set @aj_tax_county = round(@tax_county * @taxratio, 2)
          set @aj_tax_local = round(@tax_local * @taxratio, 2)
          set @aj_tax_other = round(@tax_other * @taxratio, 2)
	    ]]>
    </formula>
    <applicabilityrules>
    
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>Bankruptcy</reasoncode>
      <reasoncode>RateCorrection</reasoncode>
    </reasoncodes>
    <Kind>2</Kind>
    
    <required_inputs>
      <input_val
        name="UnusedPortChargesPercent"
        type="DECIMAL"
        displayname="Adjustment Percent for Unused Port Charges"
      />
       <input_val
        name="OverusedPortChargesPercent"
        type="DECIMAL"
        displayname="Adjustment Percent for Overused Port Charges"
      />
      <input_val
        name="CancelChargesPercent"
        type="DECIMAL"
        displayname="Adjustment Percent for Cancellation Charges"
      />
      <input_val
        name="ReservationChargesPercent"
        type="DECIMAL"
        displayname="Adjustment Percent for Reservation Charges"
      />
    </required_inputs>
   
    <outputs>
      <output_val
        name="AJ_UnusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Unused Port Charge"
      />
       <output_val
        name="AJ_OverusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Overused Port Charge"
      />
       <output_val
        name="AJ_CancelCharges"
        type="DECIMAL"
        displayname="Adjustment For Cancellation Charges"
      />
       <output_val
        name="AJ_ReservationCharges"
        type="DECIMAL"
        displayname="Adjustment For Reservation Charges"
      />
       <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
    </outputs>
   </adjustment_type>
   
   <adjustment_type>
    <name>CallRebillAdjustment</name>
    <description>Audio Conference Call record 100 percent adjustment based on prebill adjusted amount.</description>
    <displayname>Audio Conference Call record 100 percent adjustment based on prebill adjusted amount.</displayname>
    <CalculationEngine>1</CalculationEngine>
    <supportsBulk>N</supportsBulk>
    <DefaultAdjustmentDescription>
      <![CDATA[
      Adjustment caused by reassignment of Audio Conference call with ID: '@ConferenceID', 
      Name: '@ConferenceName', Start Time: '@ActualStartTime', Original Account: '@Payer'
     ]]>
    </DefaultAdjustmentDescription>
    <formula>
	    <![CDATA[
       Create Procedure Do100PercentCompensation
	        -- non required inputs 
	        @UnusedPortCharges DECIMAL,
	        @CompoundPrebillAdjedAmt DECIMAL,
	        @tax_federal DECIMAL,
	        @tax_state DECIMAL,
	        @tax_county DECIMAL,
	        @tax_local DECIMAL,
	        @tax_other DECIMAL,
	        -- outputs
	        @AJ_UnusedPortCharges DECIMAL OUTPUT,
	        @AJ_OverusedPortCharges DECIMAL OUTPUT
	        @AJ_CancelCharges DECIMAL OUTPUT,
	        @AJ_ReservationCharges DECIMAL OUTPUT,
	        @aj_tax_federal DECIMAL OUTPUT,
	        @aj_tax_state DECIMAL OUTPUT,
	        @aj_tax_county DECIMAL OUTPUT,
	        @aj_tax_local DECIMAL OUTPUT,
	        @aj_tax_other DECIMAL OUTPUT,
	        @TotalAdjustmentAmount DECIMAL OUTPUT
	        as
	        set @AJ_UnusedPortCharges = 0.0
          set @AJ_OverusedPortCharges =  0.0
          set @AJ_CancelCharges =  0.0
          set @AJ_ReservationCharges =  0.0
          set @aj_tax_federal = @tax_federal
          set @aj_tax_state = @tax_state
          set @aj_tax_county =@tax_county
          set @aj_tax_local = @tax_local
          set @aj_tax_other = @tax_other
          set @TotalAdjustmentAmount = @CompoundPrebillAdjedAmt
	    ]]>
    </formula>
    <applicabilityrules>
    </applicabilityrules>
    <reasoncodes>
      <reasoncode>Rebill</reasoncode>
    </reasoncodes>
    <Kind>4</Kind>
    
    <required_inputs>
    </required_inputs>
   
     <outputs>
      <output_val
        name="AJ_UnusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Unused Port Charge"
      />
       <output_val
        name="AJ_OverusedPortCharges"
        type="DECIMAL"
        displayname="Adjustment For Overused Port Charge"
      />
       <output_val
        name="AJ_CancelCharges"
        type="DECIMAL"
        displayname="Adjustment For Cancellation Charges"
      />
       <output_val
        name="AJ_ReservationCharges"
        type="DECIMAL"
        displayname="Adjustment For Reservation Charges"
      />
       <output_val
        name="TotalAdjustmentAmount"
        type="DECIMAL"
        displayname="Total Adjustment Amount"
      />
      <output_val
        name="aj_tax_federal"
        type="DECIMAL"
        displayname="Adjustment to Federal Tax"
      />
      <output_val
        name="aj_tax_state"
        type="DECIMAL"
        displayname="Adjustment to State Tax"
      />
      <output_val
        name="aj_tax_county"
        type="DECIMAL"
        displayname="Adjustment to County Tax"
      />
      <output_val
        name="aj_tax_local"
        type="DECIMAL"
        displayname="Adjustment to Local Tax"
      />
      <output_val
        name="aj_tax_other"
        type="DECIMAL"
        displayname="Adjustment to Other Tax"
      />
    </outputs>
   </adjustment_type>

   <composite_adjustment_type>
    <name>TestCompositeAdjustment</name>
    <description>TestCompositeAdjustment</description>
    <displayname>TestCompositeAdjustment</displayname>

    <required_inputs>
      <input_val name="ChargesPercent" type="DECIMAL" displayname="Percent Charges"/>
    </required_inputs>

    <outputs>
      <output_val name="TotalAdjustmentAmount" type="DECIMAL" displayname="Total adjustment amount"/>
    </outputs>

    <ChildAdjustments>
      <ChildAdjustment>
        <ChildPI>AudioConfCall</ChildPI>
        <ChildAdjustmentType>CallPercentAdjustment</ChildAdjustmentType>
      </ChildAdjustment>

      <ChildAdjustment>
        <ChildPI>AudioConfConn</ChildPI>
        <ChildAdjustmentType>ConnectionPercentAdjustment</ChildAdjustmentType>
      </ChildAdjustment>

      <ChildAdjustment>
	<ChildPI>AudioConfFeature</ChildPI>
	<ChildAdjustmentType>FeaturePercentAdjustment</ChildAdjustmentType>
      </ChildAdjustment>
    </ChildAdjustments>
   </composite_adjustment_type>
</priceable_item>